{"version":3,"sources":["../../../src/hooks/useTransition/TransitionMediator.js"],"names":["TransitionMediator","duration","timeline","shouldAnimate","animatedProperties","initialProperties","lastAnimatedProperties","node","render","onComplete","configure","transformAnimatedProperties","safelyRender","convertAnimatedPropertiesToValues","resetTimeline","setAnimatedProperties","needsTransition","assertAnimatingTheSameProperties","createNewTimeline","createAdjustedTimeline","configureTimeline","play","properties","isEqual","keysA","Object","keys","keysB","sort","areTheSame","join","Error","JSON","stringify","animations","createAnimations","Timeline","createAdjustedAnimations","observe","useTransition","observeTime","current","reduce","key","value","forEach","transformStyle","objectValue","toString","lastProperties","name","map","property","lastProperty","from","to","startAt","endAt","easing","easeOut","expo","lastOptions","newOptions","currentValues","getCurrentValues","shouldRedirect","progress","oldOption","option","controls","Array","isArray","slice","unshift","push","animation","objectA","objectB","dispose"],"mappings":"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","sourcesContent":["import easeOut from \"./easeOut\";\nimport { Timeline } from \"motion-ux\";\n\nexport default class TransitionMediator {\n  constructor() {\n    this.duration = 0;\n    this.timeline = null;\n    this.shouldAnimate = true;\n    this.animatedProperties = null;\n    this.initialProperties = null;\n    this.lastAnimatedProperties = null;\n    this.node = null;\n\n    this.render = () => {};\n    this.onComplete = () => {};\n    this.configure = () => {};\n  }\n\n  setShouldAnimate(shouldAnimate) {\n    this.shouldAnimate = shouldAnimate;\n  }\n\n  setAnimatedProperties(animatedProperties) {\n    this.animatedProperties = animatedProperties;\n    this.transformAnimatedProperties(animatedProperties);\n  }\n\n  setInitialProperties(initialProperties) {\n    if (this.initialProperties != null && this.lastAnimatedProperties == null) {\n      this.transformAnimatedProperties(initialProperties);\n      this.initialProperties = initialProperties;\n      this.lastAnimatedProperties = initialProperties;\n    }\n  }\n\n  setOnCompleteCallback(onComplete) {\n    if (typeof onComplete === \"function\") {\n      this.onComplete = onComplete;\n    }\n  }\n\n  setConfigureCallback(configure) {\n    if (typeof configure === \"function\") {\n      this.configure = configure;\n    }\n  }\n\n  setNode(node) {\n    if (this.node !== node) {\n      this.node = node;\n\n      if (this.node != null) {\n        this.safelyRender(this.convertAnimatedPropertiesToValues());\n        this.lastAnimatedProperties = this.animatedProperties;\n      }\n    }\n  }\n\n  setRenderCallback(render) {\n    if (typeof render === \"function\") {\n      this.render = render;\n    }\n  }\n\n  setDuration(duration) {\n    if (typeof duration === \"number\") {\n      this.duration = duration;\n    }\n  }\n\n  updateAnimationProperties(animatedProperties) {\n    if (animatedProperties == null) {\n      this.resetTimeline();\n      this.lastAnimatedProperties = null;\n      return;\n    }\n\n    this.setAnimatedProperties(animatedProperties);\n\n    if (this.lastAnimatedProperties == null || !this.shouldAnimate) {\n      this.resetTimeline();\n      this.safelyRender(this.convertAnimatedPropertiesToValues());\n      this.lastAnimatedProperties = this.animatedProperties;\n      return;\n    }\n\n    if (this.needsTransition()) {\n      this.assertAnimatingTheSameProperties();\n\n      if (this.timeline == null) {\n        this.createNewTimeline();\n      } else {\n        this.createAdjustedTimeline();\n      }\n\n      this.configureTimeline();\n      this.timeline.play();\n      this.lastAnimatedProperties = this.animatedProperties;\n    }\n  }\n\n  safelyRender(properties) {\n    if (this.node != null && typeof this.render === \"function\") {\n      this.render(this.node, properties);\n    }\n  }\n\n  needsTransition() {\n    return (\n      !this.isEqual(this.animatedProperties, this.lastAnimatedProperties) &&\n      this.lastAnimatedProperties != null\n    );\n  }\n\n  assertAnimatingTheSameProperties() {\n    const keysA = Object.keys(this.animatedProperties);\n    const keysB = Object.keys(this.lastAnimatedProperties);\n\n    keysA.sort();\n    keysB.sort();\n\n    const areTheSame = keysA.join(\"|\") === keysB.join(\"|\");\n\n    if (!areTheSame) {\n      throw new Error(\n        `Invalid Arguments: When transitioning, you need to animate all of the same properties, these have different property sets. From:${JSON.stringify(\n          this.lastAnimatedProperties\n        )}, To:${JSON.stringify(this.animatedProperties)}`\n      );\n    }\n  }\n\n  createNewTimeline() {\n    const animations = this.createAnimations();\n    this.timeline = new Timeline({ animations, duration: this.duration });\n  }\n\n  createAdjustedTimeline() {\n    const animations = this.createAdjustedAnimations();\n    this.resetTimeline();\n    this.timeline = new Timeline({ animations, duration: this.duration });\n  }\n\n  configureTimeline() {\n    if (typeof this.configure === \"function\") {\n      this.configure(this.timeline);\n    }\n\n    this.timeline.observe(\"RENDER\", ({ animations }) => {\n      this.safelyRender(animations.useTransition);\n    });\n\n    this.timeline.observeTime(1, () => {\n      this.timeline.current = null;\n      if (typeof this.onComplete === \"function\") {\n        this.onComplete();\n      }\n    });\n  }\n\n  convertAnimatedPropertiesToValues() {\n    return Object.keys(this.animatedProperties).reduce((properties, key) => {\n      properties[key] = this.animatedProperties[key].value;\n      return properties;\n    }, {});\n  }\n\n  transformAnimatedProperties(animatedProperties) {\n    Object.keys(animatedProperties).forEach((key) => {\n      animatedProperties[key] = this.transformStyle(animatedProperties[key]);\n    });\n  }\n\n  transformStyle(value) {\n    let objectValue = value;\n\n    if (typeof value === \"object\" && value != null) {\n      objectValue = value;\n    } else {\n      objectValue = {\n        value: value,\n      };\n    }\n\n    objectValue.value = objectValue.value.toString();\n    return objectValue;\n  }\n\n  createAnimations() {\n    const lastProperties = this.lastAnimatedProperties;\n    const properties = this.animatedProperties;\n    const name = \"useTransition\";\n\n    const animations = Object.keys(properties).map((key) => {\n      const property = properties[key];\n      const lastProperty = lastProperties[key];\n\n      return {\n        ...property,\n        from: lastProperty.value,\n        to: property.value,\n        property: key,\n        name: name,\n        startAt: typeof property.startAt === \"number\" ? property.startAt : 0,\n        endAt: typeof property.endAt === \"number\" ? property.endAt : 1,\n        easing: easeOut[property.easing] || easeOut.expo,\n      };\n    });\n\n    return animations;\n  }\n\n  createAdjustedAnimations() {\n    const timeline = this.timeline;\n    const lastOptions = this.lastAnimatedProperties;\n    const newOptions = this.animatedProperties;\n    const name = \"useTransition\";\n    const currentValues = timeline.getCurrentValues()[name];\n    const shouldRedirect = timeline.progress !== 1;\n\n    const animations = Object.keys(newOptions).map((key) => {\n      const oldOption = lastOptions[key];\n      const option = newOptions[key];\n      const from = currentValues[key];\n      const controls = Array.isArray(option.controls)\n        ? option.controls.slice(0)\n        : [];\n\n      if (shouldRedirect) {\n        controls.unshift(oldOption.value);\n        controls.push(option.value);\n      }\n\n      const animation = {\n        ...option,\n        property: key,\n        name: name,\n        to: option.value,\n        from,\n        controls,\n        startAt: typeof option.startAt === \"number\" ? option.startAt : 0,\n        endAt: typeof option.endAt === \"number\" ? option.endAt : 1,\n        easing: easeOut[option.easing] || easeOut.expo,\n      };\n\n      return animation;\n    });\n\n    return animations;\n  }\n\n  isEqual(objectA, objectB) {\n    return JSON.stringify(objectA) === JSON.stringify(objectB);\n  }\n\n  resetTimeline() {\n    if (this.timeline != null) {\n      this.timeline.dispose();\n      this.timeline = null;\n    }\n  }\n\n  dispose() {\n    if (this.timeline != null) {\n      this.timeline.dispose();\n    }\n  }\n}\n"],"file":"TransitionMediator.js"}