{"version":3,"sources":["../../../src/hooks/useTransition/index.js"],"names":["transformAnimatedProperties","animatedProperties","Object","keys","forEach","key","transformStyle","value","objectValue","toString","defaultApplyValues","obj","values","assertAnimatingTheSameProperties","animatedPropertiesA","animatedPropertiesB","keysA","keysB","sort","areTheSame","join","Error","JSON","stringify","useTransition","duration","applyValues","ref","animate","objectRef","timeline","lastAnimatedProperties","setValues","callbackRef","node","hasOwnProperty","current","dispose","isDifferent","reduce","properties","animations","Timeline","observe","observeTime","play"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useCallback, useState } from \"react\";\nimport { Timeline } from \"motion-ux\";\nimport createAnimations from \"./createAnimations\";\nimport createAdjustedAnimations from \"./createAdjustedAnimations\";\nimport isEqual from \"../isEqual\";\n\nconst transformAnimatedProperties = animatedProperties => {\n  Object.keys(animatedProperties).forEach(key => {\n    animatedProperties[key] = transformStyle(animatedProperties[key]);\n  });\n};\n\nconst transformStyle = value => {\n  let objectValue = value;\n\n  if (typeof value === \"object\" && value != null) {\n    objectValue = value;\n  } else {\n    objectValue = {\n      value: value\n    };\n  }\n\n  objectValue.value = objectValue.value.toString();\n  return objectValue;\n};\n\nconst defaultApplyValues = (obj, values) => {\n  if (obj != null) {\n    Object.keys(values).forEach(key => {\n      obj[key] = values[key];\n    });\n  }\n};\n\nconst assertAnimatingTheSameProperties = (\n  animatedPropertiesA,\n  animatedPropertiesB\n) => {\n  const keysA = Object.keys(animatedPropertiesA);\n  const keysB = Object.keys(animatedPropertiesB);\n\n  keysA.sort();\n  keysB.sort();\n\n  const areTheSame = keysA.join(\"|\") === keysB.join(\"|\");\n\n  if (!areTheSame) {\n    throw new Error(\n      `Invalid Arguments: useTransition cannot transition between animatedProperties that don't match between states: ${JSON.stringify(\n        animatedPropertiesA\n      )}, ${JSON.stringify(animatedPropertiesB)}`\n    );\n  }\n};\n\nconst useTransition = (\n  animatedProperties,\n  duration,\n  applyValues = defaultApplyValues,\n  ref,\n  animate = true\n) => {\n  const objectRef = useRef(null);\n  const timeline = useRef(null);\n  const lastAnimatedProperties = useRef(null);\n  const [values, setValues] = useState(null);\n\n  const callbackRef = useCallback(\n    node => {\n      if (node != null) {\n        if (typeof ref === \"function\") {\n          ref(node);\n        } else if (\n          typeof ref === \"object\" &&\n          ref != null &&\n          ref.hasOwnProperty(\"current\")\n        ) {\n          ref.current = node;\n        }\n        objectRef.current = node;\n\n        applyValues(objectRef.current, values);\n      }\n    },\n    [ref, applyValues, values]\n  );\n\n  useEffect(() => {\n    return () => {\n      if (timeline.current != null) {\n        timeline.current.dispose();\n      }\n    };\n  }, []);\n\n  // This will reset useTransition.\n  if (animatedProperties == null) {\n    // Stop the current animation, if there is one.\n    if (timeline.current != null) {\n      timeline.current.dispose();\n    }\n\n    // Reset\n    lastAnimatedProperties.current = null;\n    return objectRef;\n  }\n\n  transformAnimatedProperties(animatedProperties);\n\n  const isDifferent = !isEqual(\n    animatedProperties,\n    lastAnimatedProperties.current\n  );\n\n  if (lastAnimatedProperties.current == null || !animate) {\n    if (timeline.current != null) {\n      timeline.current.dispose();\n      timeline.current = null;\n    }\n\n    const values = Object.keys(animatedProperties).reduce((properties, key) => {\n      properties[key] = animatedProperties[key].value;\n      return properties;\n    }, {});\n\n    if (objectRef.current != null) {\n      applyValues(objectRef.current, values);\n    } else {\n      setValues(values);\n    }\n\n    lastAnimatedProperties.current = animatedProperties;\n    return objectRef;\n  } else if (isDifferent && lastAnimatedProperties.current != null) {\n    assertAnimatingTheSameProperties(\n      animatedProperties,\n      lastAnimatedProperties.current\n    );\n\n    if (timeline.current == null) {\n      const animations = createAnimations(\n        lastAnimatedProperties.current,\n        animatedProperties\n      );\n\n      timeline.current = new Timeline({\n        animations: animations,\n        duration: duration\n      });\n    } else {\n      const animations = createAdjustedAnimations(\n        timeline.current,\n        lastAnimatedProperties.current,\n        animatedProperties\n      );\n\n      timeline.current.dispose();\n\n      timeline.current = new Timeline({\n        animations: animations,\n        duration: duration\n      });\n    }\n\n    timeline.current.observe(\"RENDER\", ({ animations }) => {\n      if (objectRef.current != null) {\n        applyValues(objectRef.current, animations.useTransition);\n      }\n    });\n\n    timeline.current.observeTime(1, () => {\n      timeline.current = null;\n    });\n\n    timeline.current.play();\n\n    lastAnimatedProperties.current = animatedProperties;\n    return objectRef;\n  }\n\n  return callbackRef;\n};\n\nexport default useTransition;\n"],"file":"index.js"}