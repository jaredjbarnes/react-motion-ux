{"version":3,"sources":["../../../src/hooks/useTransition/index.js"],"names":["useTransition","animatedProperties","duration","applyValues","objectApplyValues","ref","animate","objectRef","timeline","lastAnimatedProperties","values","setValues","callbackRef","node","hasOwnProperty","current","dispose","isDifferent","Object","keys","reduce","properties","key","value","animations","Timeline","observe","observeTime","play"],"mappings":"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","sourcesContent":["import { useEffect, useRef, useCallback, useState } from \"react\";\nimport { Timeline } from \"motion-ux\";\nimport createAnimations from \"./createAnimations\";\nimport createAdjustedAnimations from \"./createAdjustedAnimations\";\nimport isEqual from \"../isEqual\";\nimport transformAnimatedProperties from \"./transformAnimatedProperties\";\nimport objectApplyValues from \"./objectApplyValues\";\nimport assertAnimatingTheSameProperties from \"./assertAnimatingTheSameProperties\";\n\nconst useTransition = (\n  animatedProperties,\n  duration,\n  applyValues = objectApplyValues,\n  ref,\n  animate = true\n) => {\n  const objectRef = useRef(null);\n  const timeline = useRef(null);\n  const lastAnimatedProperties = useRef(null);\n  const [values, setValues] = useState(null);\n\n  const callbackRef = useCallback(\n    node => {\n      if (node != null) {\n        if (typeof ref === \"function\") {\n          ref(node);\n        } else if (\n          typeof ref === \"object\" &&\n          ref != null &&\n          ref.hasOwnProperty(\"current\")\n        ) {\n          ref.current = node;\n        }\n        objectRef.current = node;\n\n        applyValues(objectRef.current, values);\n      }\n    },\n    [ref, applyValues, values]\n  );\n\n  useEffect(() => {\n    return () => {\n      if (timeline.current != null) {\n        timeline.current.dispose();\n      }\n    };\n  }, []);\n\n  // This will reset useTransition.\n  if (animatedProperties == null) {\n    // Stop the current animation, if there is one.\n    if (timeline.current != null) {\n      timeline.current.dispose();\n    }\n\n    // Reset\n    lastAnimatedProperties.current = null;\n    return objectRef;\n  }\n\n  transformAnimatedProperties(animatedProperties);\n\n  const isDifferent = !isEqual(\n    animatedProperties,\n    lastAnimatedProperties.current\n  );\n\n  if (lastAnimatedProperties.current == null || !animate) {\n    if (timeline.current != null) {\n      timeline.current.dispose();\n      timeline.current = null;\n    }\n\n    const values = Object.keys(animatedProperties).reduce((properties, key) => {\n      properties[key] = animatedProperties[key].value;\n      return properties;\n    }, {});\n\n    if (objectRef.current != null) {\n      applyValues(objectRef.current, values);\n    } else {\n      setValues(values);\n    }\n\n    lastAnimatedProperties.current = animatedProperties;\n    return callbackRef;\n  } else if (isDifferent && lastAnimatedProperties.current != null) {\n    assertAnimatingTheSameProperties(\n      animatedProperties,\n      lastAnimatedProperties.current\n    );\n\n    if (timeline.current == null) {\n      const animations = createAnimations(\n        lastAnimatedProperties.current,\n        animatedProperties\n      );\n\n      timeline.current = new Timeline({\n        animations: animations,\n        duration: duration\n      });\n    } else {\n      const animations = createAdjustedAnimations(\n        timeline.current,\n        lastAnimatedProperties.current,\n        animatedProperties\n      );\n\n      timeline.current.dispose();\n\n      timeline.current = new Timeline({\n        animations: animations,\n        duration: duration\n      });\n    }\n\n    timeline.current.observe(\"RENDER\", ({ animations }) => {\n      if (objectRef.current != null) {\n        applyValues(objectRef.current, animations.useTransition);\n      }\n    });\n\n    timeline.current.observeTime(1, () => {\n      timeline.current = null;\n    });\n\n    timeline.current.play();\n\n    lastAnimatedProperties.current = animatedProperties;\n    return callbackRef;\n  }\n\n  return callbackRef;\n};\n\nexport default useTransition;\n"],"file":"index.js"}