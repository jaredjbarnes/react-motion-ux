{"version":3,"sources":["../../../src/hooks/useTransition/index.js"],"names":["convertToValues","animatedProperties","Object","keys","reduce","properties","key","value","useTransition","duration","applyValues","objectApplyValues","ref","animate","onComplete","state","lastAnimatedProperties","timeline","node","current","callbackRef","hasOwnProperty","values","dispose","isDifferent","animations","Timeline","observe","observeTime","play"],"mappings":"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","sourcesContent":["import { useEffect, useRef, useCallback } from \"react\";\nimport { Timeline } from \"motion-ux\";\nimport createAnimations from \"./createAnimations\";\nimport createAdjustedAnimations from \"./createAdjustedAnimations\";\nimport isEqual from \"../isEqual\";\nimport transformAnimatedProperties from \"./transformAnimatedProperties\";\nimport objectApplyValues from \"./objectApplyValues\";\nimport assertAnimatingTheSameProperties from \"./assertAnimatingTheSameProperties\";\n\nconst convertToValues = animatedProperties => {\n  return Object.keys(animatedProperties).reduce((properties, key) => {\n    properties[key] = animatedProperties[key].value;\n    return properties;\n  }, {});\n};\n\nconst useTransition = (\n  animatedProperties,\n  {\n    duration,\n    applyValues = objectApplyValues,\n    ref,\n    animate = true,\n    onComplete\n  } = {}\n) => {\n  const state = useRef({\n    lastAnimatedProperties: null,\n    animatedProperties,\n    duration,\n    applyValues,\n    ref,\n    animate,\n    timeline: null,\n    node: null\n  });\n\n  state.current.animatedProperties = animatedProperties;\n  state.current.duration = duration;\n  state.current.applyValues = applyValues;\n  state.current.ref = ref;\n  state.current.animate = animate;\n\n  // Keep refs up to date.\n  const callbackRef = useCallback(node => {\n    const { animatedProperties, applyValues, ref } = state.current;\n\n    if (node != null) {\n      if (typeof ref === \"function\") {\n        ref(node);\n      } else if (\n        typeof ref === \"object\" &&\n        ref != null &&\n        ref.hasOwnProperty(\"current\")\n      ) {\n        ref.current = node;\n      }\n\n      state.current.node = node;\n\n      // This should run when the element is mounted.\n      const values = convertToValues(animatedProperties);\n\n      applyValues(state.current.node, values);\n      state.current.lastAnimatedProperties = animatedProperties;\n    }\n  }, []);\n\n  // Clean up timeline to prevent memory leak.\n  useEffect(() => {\n    return () => {\n      if (state.current.timeline != null) {\n        state.current.timeline.dispose();\n      }\n    };\n  }, []);\n\n  if (animatedProperties == null) {\n    // Stop the current animation, if there is one.\n    if (state.current.timeline != null) {\n      state.current.timeline.dispose();\n    }\n\n    // Reset\n    state.current.lastAnimatedProperties = null;\n    return callbackRef;\n  }\n\n  transformAnimatedProperties(animatedProperties);\n\n  const isDifferent = !isEqual(\n    animatedProperties,\n    state.current.lastAnimatedProperties\n  );\n\n  if (state.current.lastAnimatedProperties == null || !animate) {\n    if (state.current.timeline != null) {\n      state.current.timeline.dispose();\n      state.current.timeline = null;\n    }\n\n    const values = convertToValues(animatedProperties);\n\n    if (state.current.node != null) {\n      applyValues(state.current.node, values);\n    }\n\n    state.current.lastAnimatedProperties = animatedProperties;\n    return callbackRef;\n  } else if (isDifferent && state.current.lastAnimatedProperties != null) {\n    assertAnimatingTheSameProperties(\n      animatedProperties,\n      state.current.lastAnimatedProperties\n    );\n\n    if (state.current.timeline == null) {\n      const animations = createAnimations(\n        state.current.lastAnimatedProperties,\n        animatedProperties\n      );\n\n      state.current.timeline = new Timeline({\n        animations: animations,\n        duration: duration\n      });\n    } else {\n      const animations = createAdjustedAnimations(\n        state.current.timeline,\n        state.current.lastAnimatedProperties,\n        animatedProperties\n      );\n\n      state.current.timeline.dispose();\n\n      state.current.timeline = new Timeline({\n        animations: animations,\n        duration: duration\n      });\n    }\n\n    state.current.timeline.observe(\"RENDER\", ({ animations }) => {\n      if (state.current.node != null) {\n        applyValues(state.current.node, animations.useTransition);\n      }\n    });\n\n    state.current.timeline.observeTime(1, () => {\n      state.current.timeline.current = null;\n      if (typeof onComplete === \"function\") {\n        onComplete();\n      }\n    });\n\n    state.current.timeline.play();\n    state.current.lastAnimatedProperties = animatedProperties;\n  }\n\n  return callbackRef;\n};\n\nexport default useTransition;\n"],"file":"index.js"}