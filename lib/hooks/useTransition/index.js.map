{"version":3,"sources":["../../../src/hooks/useTransition/index.js"],"names":["convertToValues","animatedProperties","Object","keys","reduce","properties","key","value","useTransition","duration","applyValues","objectApplyValues","ref","animate","onComplete","configure","initialProperties","state","lastAnimatedProperties","timeline","node","current","callbackRef","hasOwnProperty","values","dispose","isDifferent","animations","Timeline","observe","observeTime","play"],"mappings":"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","sourcesContent":["import { useEffect, useRef, useCallback } from \"react\";\nimport { Timeline } from \"motion-ux\";\nimport createAnimations from \"./createAnimations\";\nimport createAdjustedAnimations from \"./createAdjustedAnimations\";\nimport isEqual from \"../isEqual\";\nimport transformAnimatedProperties from \"./transformAnimatedProperties\";\nimport objectApplyValues from \"./objectApplyValues\";\nimport assertAnimatingTheSameProperties from \"./assertAnimatingTheSameProperties\";\n\nconst convertToValues = animatedProperties => {\n  return Object.keys(animatedProperties).reduce((properties, key) => {\n    properties[key] = animatedProperties[key].value;\n    return properties;\n  }, {});\n};\n\nconst useTransition = (\n  animatedProperties,\n  {\n    duration,\n    applyValues = objectApplyValues,\n    ref,\n    animate = true,\n    onComplete,\n    configure,\n    initialProperties = null\n  } = {}\n) => {\n  const state = useRef({\n    lastAnimatedProperties: null,\n    animatedProperties,\n    duration,\n    applyValues,\n    ref,\n    animate,\n    timeline: null,\n    node: null\n  });\n\n  if (initialProperties != null && state.current.lastAnimatedProperties == null) {\n    transformAnimatedProperties(initialProperties);\n    state.current.lastAnimatedProperties = initialProperties;\n  }\n\n  state.current.animatedProperties = animatedProperties;\n  state.current.duration = duration;\n  state.current.applyValues = applyValues;\n  state.current.ref = ref;\n  state.current.animate = animate;\n\n  // Keep refs up to date.\n  const callbackRef = useCallback(node => {\n    const { animatedProperties, applyValues, ref } = state.current;\n\n    if (node != null) {\n      if (typeof ref === \"function\") {\n        ref(node);\n      } else if (\n        typeof ref === \"object\" &&\n        ref != null &&\n        ref.hasOwnProperty(\"current\")\n      ) {\n        ref.current = node;\n      }\n\n      state.current.node = node;\n\n      // This should run when the element is mounted.\n      const values = convertToValues(animatedProperties);\n\n      applyValues(state.current.node, values);\n      state.current.lastAnimatedProperties = animatedProperties;\n    }\n  }, []);\n\n  // Clean up timeline to prevent memory leak.\n  useEffect(() => {\n    return () => {\n      if (state.current.timeline != null) {\n        state.current.timeline.dispose();\n      }\n    };\n  }, []);\n\n  if (animatedProperties == null) {\n    // Stop the current animation, if there is one.\n    if (state.current.timeline != null) {\n      state.current.timeline.dispose();\n    }\n\n    // Reset\n    state.current.lastAnimatedProperties = null;\n    return callbackRef;\n  }\n\n  transformAnimatedProperties(animatedProperties);\n\n  const isDifferent = !isEqual(\n    animatedProperties,\n    state.current.lastAnimatedProperties\n  );\n\n  if (state.current.lastAnimatedProperties == null || !animate) {\n    if (state.current.timeline != null) {\n      state.current.timeline.dispose();\n      state.current.timeline = null;\n    }\n\n    const values = convertToValues(animatedProperties);\n\n    if (state.current.node != null) {\n      applyValues(state.current.node, values);\n    }\n\n    state.current.lastAnimatedProperties = animatedProperties;\n    return callbackRef;\n  } else if (isDifferent && state.current.lastAnimatedProperties != null) {\n    assertAnimatingTheSameProperties(\n      animatedProperties,\n      state.current.lastAnimatedProperties\n    );\n\n    if (state.current.timeline == null) {\n      const animations = createAnimations(\n        state.current.lastAnimatedProperties,\n        animatedProperties\n      );\n\n      state.current.timeline = new Timeline({\n        animations: animations,\n        duration: duration\n      });\n    } else {\n      const animations = createAdjustedAnimations(\n        state.current.timeline,\n        state.current.lastAnimatedProperties,\n        animatedProperties\n      );\n\n      state.current.timeline.dispose();\n\n      state.current.timeline = new Timeline({\n        animations: animations,\n        duration: duration\n      });\n    }\n\n    if (typeof configure === \"function\") {\n      configure(state.current.timeline);\n    }\n\n    state.current.timeline.observe(\"RENDER\", ({ animations }) => {\n      if (state.current.node != null) {\n        applyValues(state.current.node, animations.useTransition);\n      }\n    });\n\n    state.current.timeline.observeTime(1, () => {\n      state.current.timeline.current = null;\n      if (typeof onComplete === \"function\") {\n        onComplete();\n      }\n    });\n\n    state.current.timeline.play();\n    state.current.lastAnimatedProperties = animatedProperties;\n  }\n\n  return callbackRef;\n};\n\nexport default useTransition;\n"],"file":"index.js"}