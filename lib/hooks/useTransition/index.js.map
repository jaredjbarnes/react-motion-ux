{"version":3,"sources":["../../../src/hooks/useTransition/index.js"],"names":["transformAnimatedProperties","animatedProperties","Object","keys","forEach","key","transformStyle","value","objectValue","toString","defaultApplyValues","obj","values","assertAnimatingTheSameProperties","animatedPropertiesA","animatedPropertiesB","keysA","keysB","sort","areTheSame","join","Error","JSON","stringify","useTransition","duration","applyValues","objectRef","timeline","lastAnimatedProperties","animationFrame","current","dispose","cancelAnimationFrame","isDifferent","reduce","properties","updateObject","requestAnimationFrame","animations","Timeline","observe","observeTime","play"],"mappings":"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","sourcesContent":["import { useEffect, useRef } from \"react\";\nimport { Timeline } from \"motion-ux\";\nimport createAnimations from \"./createAnimations\";\nimport createAdjustedAnimations from \"./createAdjustedAnimations\";\nimport isEqual from \"../isEqual\";\n\nconst transformAnimatedProperties = animatedProperties => {\n  Object.keys(animatedProperties).forEach(key => {\n    animatedProperties[key] = transformStyle(animatedProperties[key]);\n  });\n};\n\nconst transformStyle = value => {\n  let objectValue = value;\n\n  if (typeof value === \"object\" && value != null) {\n    objectValue = value;\n  } else {\n    objectValue = {\n      value: value\n    };\n  }\n\n  objectValue.value = objectValue.value.toString();\n  return objectValue;\n};\n\nconst defaultApplyValues = (obj, values) => {\n  if (obj != null) {\n    Object.keys(values).forEach(key => {\n      obj[key] = values[key];\n    });\n  }\n};\n\nconst assertAnimatingTheSameProperties = (\n  animatedPropertiesA,\n  animatedPropertiesB\n) => {\n  const keysA = Object.keys(animatedPropertiesA);\n  const keysB = Object.keys(animatedPropertiesB);\n\n  keysA.sort();\n  keysB.sort();\n\n  const areTheSame = keysA.join(\"|\") === keysB.join(\"|\");\n\n  if (!areTheSame) {\n    throw new Error(\n      `Invalid Arguments: useTransition cannot transition between animatedProperties that don't match between states: ${JSON.stringify(\n        animatedPropertiesA\n      )}, ${JSON.stringify(animatedPropertiesB)}`\n    );\n  }\n};\n\nconst useTransition = (\n  animatedProperties,\n  duration,\n  applyValues = defaultApplyValues\n) => {\n  const objectRef = useRef(null);\n  const timeline = useRef(null);\n  const lastAnimatedProperties = useRef(null);\n  const animationFrame = useRef(null);\n\n  useEffect(() => {\n    return () => {\n      if (timeline.current != null) {\n        timeline.current.dispose();\n      }\n      cancelAnimationFrame(animationFrame.current);\n    };\n  }, []);\n\n  // This will reset useTransition.\n  if (animatedProperties == null) {\n\n    // Stop the current animation, if there is one.\n    if (timeline.current != null) {\n      timeline.current.dispose();\n    }\n\n    // Reset\n    lastAnimatedProperties.current = null;\n    return objectRef;\n  }\n\n  transformAnimatedProperties(animatedProperties);\n\n  const isDifferent = !isEqual(\n    animatedProperties,\n    lastAnimatedProperties.current\n  );\n\n  /* \n    Since we didn't come from anything just set the values. This will prevent unneeded \n    chern on the CPU on initialization. This is a little tricky because these refs are \n    associated with other components, so the ref may not be here when this component mounts.\n    So we try to render every animation frame until this is unmounted or it actually renders \n    it's initial value.\n  */\n  if (lastAnimatedProperties.current == null) {\n    const values = Object.keys(animatedProperties).reduce((properties, key) => {\n      properties[key] = animatedProperties[key].value;\n      return properties;\n    }, {});\n\n    const updateObject = values => {\n      if (objectRef.current == null) {\n        animationFrame.current = requestAnimationFrame(() => {\n          updateObject(values);\n        });\n      } else {\n        applyValues(objectRef.current, values);\n      }\n    };\n\n    updateObject(values);\n\n    lastAnimatedProperties.current = animatedProperties;\n    return objectRef;\n  }\n\n  if (isDifferent && lastAnimatedProperties.current != null) {\n    assertAnimatingTheSameProperties(\n      animatedProperties,\n      lastAnimatedProperties.current\n    );\n\n    if (timeline.current == null) {\n      const animations = createAnimations(\n        lastAnimatedProperties.current,\n        animatedProperties\n      );\n\n      timeline.current = new Timeline({\n        animations: animations,\n        duration: duration\n      });\n    } else {\n      const animations = createAdjustedAnimations(\n        timeline.current,\n        lastAnimatedProperties.current,\n        animatedProperties\n      );\n\n      timeline.current.dispose();\n\n      timeline.current = new Timeline({\n        animations: animations,\n        duration: duration\n      });\n    }\n\n    timeline.current.observe(\"RENDER\", ({animations}) => {\n      applyValues(objectRef.current, animations.useTransition);\n    });\n\n    timeline.current.observeTime(1, () => {\n      timeline.current = null;\n    });\n\n    timeline.current.play();\n\n    lastAnimatedProperties.current = animatedProperties;\n    return objectRef;\n  }\n\n  return objectRef;\n};\n\nexport default useTransition;\n"],"file":"index.js"}